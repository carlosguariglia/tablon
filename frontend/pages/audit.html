<!-- Panel de auditoría solo visible para admin -->
<div id="auditPanel" style="display:none; margin:32px 0;">
  <h2>Auditoría de acciones</h2>
  <table id="auditTable" border="1" style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th>Usuario</th>
        <th>Email</th>
        <th>Acción</th>
        <th>Detalles</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<body>
  <div style="margin:32px 0; background:#faf5ff; border-radius:20px; box-shadow:0 4px 32px rgba(88,28,135,0.12); border:1px solid #e5d9ff; padding:2rem;">
    <h2>Auditoría</h2>
    <div id="auditLogs"></div>
  <button id="backToTablon" class="btn" style="margin-top:20px; background:#8b5cf6; color:#fff; border-radius:10px; font-size:1.08rem; font-weight:700; box-shadow:0 2px 12px rgba(139,92,246,0.3); border:none;">← Volver al Tablón</button>
  </div>
</body>
<script>
document.getElementById('backToTablon').onclick = function() {
  window.location.href = '/pages/tablon.html';
};
// Mostrar panel solo si el usuario es admin
function showAuditPanelIfAdmin() {
  const user = JSON.parse(localStorage.getItem('user'));
  if (user && user.name === 'admin' && user.email === 'admin@gmail.com') {
    document.getElementById('auditPanel').style.display = 'block';
    fetchAuditLogs();
  }
}

async function fetchAuditLogs() {
  const token = localStorage.getItem('token');
  const res = await fetch('/api/audit', {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  if (!res.ok) return;
  const logs = await res.json();
  const tbody = document.querySelector('#auditTable tbody');
  tbody.innerHTML = '';
  logs.forEach(log => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${log.user_name}</td>
      <td>${log.user_email}</td>
      <td>${log.action}</td>
      <td>${log.details || ''}</td>
      <td>${new Date(log.timestamp).toLocaleString()}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.addEventListener('DOMContentLoaded', showAuditPanelIfAdmin);
</script>
